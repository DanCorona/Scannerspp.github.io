 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Inventory MVP</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        :root {
            --primary: #2563eb;
            --danger: #ef4444;
            --bg: #f3f4f6;
            --card: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Camera Section */
        #reader {
            width: 100%;
            background: black;
            min-height: 300px;
        }

        /* List Section */
        #list-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .item-card {
            background: var(--card);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #6b7280;
        }

        .item-name-input {
            width: 100%;
            border: 1px solid #ddd;
            padding: 8px;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: bold;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 5px;
        }

        .qty-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        button {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-qty { background: #e5e7eb; color: black; }
        .btn-del { background: var(--danger); color: white; }
        .btn-export { background: #10b981; color: white; width: 100%; margin-top: 10px; padding: 15px;}
        .btn-clear { background: #6b7280; color: white; margin-top: 10px; width: 100%; }

        /* Footer Actions */
        .actions {
            padding: 1rem;
            background: var(--card);
            border-top: 1px solid #ddd;
        }

    </style>
</head>
<body>

<header>
    <h2>Scanner App</h2>
</header>

<div id="reader"></div>

<div id="list-container">
    <div id="empty-state" style="text-align: center; color: #888; margin-top: 20px;">
        Scan a barcode to begin...
    </div>
</div>

<div class="actions">
    <button class="btn-export" onclick="exportData()">Copy List to Clipboard</button>
    <button class="btn-clear" onclick="clearData()">Clear All Data</button>
</div>

<script>
    // --- 1. STATE MANAGEMENT ---
    let inventory = JSON.parse(localStorage.getItem('barcode-inventory')) || [];
    let lastScannedCode = null;
    let lastScanTime = 0;

    // --- 2. AUDIO FEEDBACK (BEEP) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function beep() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.type = 'square';
        oscillator.frequency.value = 800; // Hz
        gainNode.gain.value = 0.1;
        oscillator.start();
        setTimeout(() => oscillator.stop(), 100);
    }

    // --- 3. SCANNER LOGIC ---
    function onScanSuccess(decodedText, decodedResult) {
        const now = Date.now();
        // Debounce: prevent reading the same code 50 times a second
        if (decodedText === lastScannedCode && now - lastScanTime < 2000) {
            return;
        }

        lastScannedCode = decodedText;
        lastScanTime = now;
        
        beep();
        addItem(decodedText);
    }

    // Initialize the library
    let html5QrcodeScanner = new Html5QrcodeScanner(
        "reader", 
        { fps: 10, qrbox: { width: 250, height: 250 } },
        /* verbose= */ false
    );
    html5QrcodeScanner.render(onScanSuccess);


    // --- 4. CRUD OPERATIONS ---

    function addItem(sku) {
        const existingItem = inventory.find(item => item.sku === sku);

        if (existingItem) {
            existingItem.qty++;
            // Move to top
            inventory = inventory.filter(i => i.sku !== sku);
            inventory.unshift(existingItem);
        } else {
            inventory.unshift({
                id: Date.now(),
                sku: sku,
                name: '', // Empty name triggers placeholder logic
                qty: 1
            });
        }
        saveAndRender();
    }

    function updateName(id, newName) {
        const item = inventory.find(i => i.id === id);
        if (item) item.name = newName;
        save(); // Don't re-render, otherwise input loses focus
    }

    function changeQty(id, change) {
        const item = inventory.find(i => i.id === id);
        if (item) {
            item.qty += change;
            if (item.qty <= 0) deleteItem(id);
            else saveAndRender();
        }
    }

    function deleteItem(id) {
        if(confirm("Delete this item?")) {
            inventory = inventory.filter(i => i.id !== id);
            saveAndRender();
        }
    }

    function clearData() {
        if(confirm("Clear the entire list?")) {
            inventory = [];
            saveAndRender();
        }
    }

    // --- 5. STORAGE & UI ---

    function save() {
        localStorage.setItem('barcode-inventory', JSON.stringify(inventory));
    }

    function saveAndRender() {
        save();
        render();
    }

    function render() {
        const container = document.getElementById('list-container');
        const emptyState = document.getElementById('empty-state');
        
        container.innerHTML = '';
        
        if (inventory.length === 0) {
            container.appendChild(emptyState);
            return;
        }

        inventory.forEach(item => {
            const div = document.createElement('div');
            div.className = 'item-card';
            div.innerHTML = `
                <div class="item-header">
                    <span>SKU: ${item.sku}</span>
                </div>
                <input 
                    type="text" 
                    class="item-name-input" 
                    placeholder="Tap to name item..." 
                    value="${item.name}" 
                    oninput="updateName(${item.id}, this.value)"
                >
                <div class="controls">
                    <div class="qty-controls">
                        <button class="btn-qty" onclick="changeQty(${item.id}, -1)">-</button>
                        <strong>Qty: ${item.qty}</strong>
                        <button class="btn-qty" onclick="changeQty(${item.id}, 1)">+</button>
                    </div>
                    <button class="btn-del" onclick="deleteItem(${item.id})">Delete</button>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function exportData() {
        let text = "Inventory List:\n";
        inventory.forEach(i => {
            let name = i.name || "Unknown Item";
            text += `- [${i.qty}] ${name} (SKU: ${i.sku})\n`;
        });
        
        navigator.clipboard.writeText(text).then(() => {
            alert("List copied to clipboard!");
        });
    }

    // Initial Render
    render();

</script>
</body>
</html>
